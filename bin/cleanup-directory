#!/usr/local/bin/zsh
number_left=20
directory=$HOME/Pictures
file_glob=*

usage () { echo "-d directory to clean
-f glob pattern of files to clean
-l number of files to leave"; }

while getopts "hvd:f:l:" opt; do
    case $opt in
        d ) directory=$OPTARG;;
        f ) file_glob=$OPTARG;;
        l ) number_left=$OPTARG;;
        v ) verbose=1;;
        h ) usage; exit;;
    esac
done

setopt GLOB_SUBST

find $directory -maxdepth 1 -path "$file_glob" -not -path '*/\.*' -mtime +1 \( -type f -or -type d \) |\
while read file
do
  stat -f "%-10m %40N" $file
done |\
sort -n | \
/usr/local/bin/ghead --lines=-$number_left |\
while read date filename
do
  if [[ -v verbose ]]
  then
    echo trashing "$filename"
  fi
  /usr/local/bin/trash "$filename"
done
