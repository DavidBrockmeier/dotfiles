#!/bin/bash
min_runs=10

usage () { echo "OPTIONS:

-m minimum number of runs"; }

while getopts "hvm:" opt; do
    case $opt in
        m ) min_runs=$OPTARG;;
        v ) verbose=1;;
        h ) usage; exit;;
    esac
done

FILENAME=`mktemp`
if [ -x "$(command -v hyperfine)" ]; then
    hyperfine --warmup 1 --min-runs $min_runs 'zsh -i -c exit'
else
    for ((i=1;i<=$min_runs;i++)); do
      time zsh -i -c exit
    done 2>&1 | grep real | sed 's/real//' | sed 's/0m//' | sed 's/s$//' | tr -d "[:blank:]" | tee -a $FILENAME

    awk '{ sum += $1; sum_square += $1^2 } \
    END { \
      printf "Count\t%d\nTotal\t%.1f\nSt.dev.\t%.3f\nAverage\t%.3f\n", \
        NR, sum, sqrt(sum_square/NR-(sum/NR)^2), sum/NR \
    }' $FILENAME
fi
