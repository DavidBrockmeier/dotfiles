#!/bin/zsh
# script to find the shortest abbreviation for autojump for the current, or given directory
if [ -z "$1" ]; then
    directory=$PWD
else
    directory=$(realpath $1)
    if [ ! -d "$directory" ]; then
        echo "$directory is not a valid, existing directory"
        exit
    fi
fi

basename=$(basename $directory | tr '[:upper:]' '[:lower:]')
characters=()
for ((i = 0; i < ${#basename}; i++)); do
    characters+=${basename:$i:1}
done

setopt nocasematch

for c in "${characters[@]}"; do
    if [[ $basename =~ $c ]]; then
        local dir=$(zoxide query $c 2>/dev/null || true)

        if [[ "$dir" == "$directory" ]]; then
            echo $c
            exit
        fi
    fi
done

for c in "${characters[@]}"; do
    if [[ $basename =~ $c ]]; then
        for d in "${characters[@]}"; do
            local dir=$(zoxide query $c$d 2>/dev/null || true)

            if [[ "$dir" == "$directory" ]]; then
                echo $c$d
                found=1
            fi
        done
    fi
done
if [[ -n $found ]]; then
    exit
fi
echo "No one or two character abbreviation found for $directory"

for c in "${characters[@]}"; do
    if [[ $basename =~ $c ]]; then
        for d in "${characters[@]}"; do
            if [[ $basename =~ $d ]]; then
                for e in "${characters[@]}"; do
                    local dir=$(zoxide query $c$d$e 2>/dev/null || true)

                    if [[ "$dir" == "$directory" ]]; then
                        echo $c$d$e
                        exit
                    fi
                done
            fi
        done
        echo "No three character abbreviation starting with $c found for $directory"
    fi
done

echo "No abbreviation found for $directory"
